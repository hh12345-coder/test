# 后端重启说明

## 方式一：本地运行（开发环境）

### 1. 停止当前运行的服务
- 如果是在终端运行，按 `Ctrl + C` 停止
- 如果是在后台运行，找到进程并结束它

### 2. 重新启动服务

在项目根目录（`智能跨校约饭`）打开终端，运行：

```bash
# Windows PowerShell
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 或者使用 Python 直接运行
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**参数说明：**
- `--reload`: 代码修改后自动重启（开发环境推荐）
- `--host 0.0.0.0`: 允许外部访问
- `--port 8000`: 端口号（可根据需要修改）

### 3. 验证服务是否启动成功

打开浏览器访问：`http://localhost:8000/health`

应该看到：`{"status":"ok"}`

或者访问：`http://localhost:8000/docs` 查看API文档

---

## 方式二：Railway 部署（生产环境）

### 方法A：通过 Railway 控制台重启

1. 登录 [Railway](https://railway.app/)
2. 进入你的项目
3. 找到服务（Service）
4. 点击服务设置（Settings）
5. 找到 "Restart" 或 "Redeploy" 按钮
6. 点击重启服务

### 方法B：通过 Git 推送触发重新部署

```bash
# 1. 确保所有更改已提交
git add .
git commit -m "更新后端代码，添加学校管理功能"

# 2. 推送到 Railway 连接的仓库
git push origin main
# 或者
git push railway main
```

Railway 会自动检测到代码更新并重新部署。

### 方法C：使用 Railway CLI

```bash
# 1. 安装 Railway CLI（如果还没安装）
npm i -g @railway/cli

# 2. 登录
railway login

# 3. 连接到项目
railway link

# 4. 重启服务
railway restart
```

---

## 方式三：使用脚本重启（Windows）

### 创建重启脚本

我已经为你创建了重启脚本，你可以：

1. **双击运行** `restart_backend.bat`（如果已创建）
2. **或者在 PowerShell 中运行：**

```powershell
# 进入项目目录
cd "C:\Users\chang\Desktop\111\智能跨校约饭"

# 停止可能运行的进程（如果有）
Get-Process | Where-Object {$_.ProcessName -like "*python*" -or $_.ProcessName -like "*uvicorn*"} | Stop-Process -Force

# 启动服务
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

---

## 验证新功能是否生效

重启后，测试以下接口：

1. **获取学校列表：**
   ```
   GET http://localhost:8000/api/schools
   ```

2. **上传截图：**
   ```
   POST http://localhost:8000/api/schedule/upload/screenshot
   ```

3. **批量上传截图：**
   ```
   POST http://localhost:8000/api/schedule/upload/screenshots
   ```

4. **地点推荐（使用学校ID）：**
   ```
   POST http://localhost:8000/api/places/recommend
   Body: {
     "school_ids": [1, 2],
     "travel_mode": "walking"
   }
   ```

---

## 常见问题

### Q: 端口被占用怎么办？
A: 可以换一个端口：
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8001
```

### Q: 如何查看运行日志？
A: 服务启动后，终端会显示所有请求日志。

### Q: Railway 部署后如何查看日志？
A: 在 Railway 控制台的 "Deployments" 或 "Logs" 标签页查看。

### Q: 数据库表没有创建怎么办？
A: 代码中已经有 `Base.metadata.create_all(bind=engine)`，首次运行会自动创建表。如果表已存在，不会重复创建。

---

## 快速重启命令（复制即用）

**Windows PowerShell:**
```powershell
cd "C:\Users\chang\Desktop\111\智能跨校约饭"; uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**Windows CMD:**
```cmd
cd C:\Users\chang\Desktop\111\智能跨校约饭 && uvicorn main:app --reload --host 0.0.0.0 --port 8000
```


